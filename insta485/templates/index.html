{% extends "base.html" %}

{% block content %}
<div class="feed">
    {% for post in posts %}
    <div class="post">
        <div class="post-header">
            <img src="{{ post.owner_img_url }}" alt="{{ post.owner }}" class="avatar">
            <a href="{{ url_for('show_user', user_url_slug=post.owner) }}">{{ post.owner }}</a>
            <span class="timestamp">{{ post.timestamp }}</span>
        </div>
        
        <img src="{{ post.img_url }}" alt="Post" class="post-image">
        
        <div class="post-actions">
            {% if post.user_liked %}
                <form action="{{ url_for('update_likes') }}?target={{ url_for('show_index') }}" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="operation" value="unlike">
                    <input type="hidden" name="postid" value="{{ post.postid }}">
                    <input type="submit" name="unlike" value="unlike">
                </form>
            {% else %}
                <form action="{{ url_for('update_likes') }}?target={{ url_for('show_index') }}" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="operation" value="like">
                    <input type="hidden" name="postid" value="{{ post.postid }}">
                    <input type="submit" name="like" value="like">
                </form>
            {% endif %}
            <span>{{ post.likes }} likes</span>
        </div>
        
        <div class="comments">
            {% for comment in post.comments %}
            <div class="comment">
                <strong>{{ comment.owner }}</strong> {{ comment.text }}
                {% if comment.owner == logname %}
                <form action="{{ url_for('update_comments') }}?target={{ url_for('show_index') }}" method="post" enctype="multipart/form-data" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="operation" value="delete">
                    <input type="hidden" name="commentid" value="{{ comment.commentid }}">
                    <input type="submit" name="uncomment" value="delete">
                </form>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <form action="{{ url_for('update_comments') }}?target={{ url_for('show_index') }}" method="post" enctype="multipart/form-data" class="comment-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="operation" value="create">
            <input type="hidden" name="postid" value="{{ post.postid }}">
            <input type="text" name="text" placeholder="Add a comment..." required>
            <input type="submit" name="comment" value="comment">
        </form>
    </div>
    {% endfor %}
</div>
{% endblock %}
